\hypertarget{gquad_8h_source}{}\section{gquad.\+h}
\label{gquad_8h_source}\index{Vienna\+R\+N\+A/gquad.\+h@{Vienna\+R\+N\+A/gquad.\+h}}

\begin{DoxyCode}
00001 \textcolor{preprocessor}{#ifndef VIENNA\_RNA\_PACKAGE\_GQUAD\_H}
00002 \textcolor{preprocessor}{#define VIENNA\_RNA\_PACKAGE\_GQUAD\_H}
00003 
00004 \textcolor{preprocessor}{#include <\hyperlink{data__structures_8h}{ViennaRNA/data\_structures.h}>}
00005 \textcolor{preprocessor}{#include <\hyperlink{params_8h}{ViennaRNA/params.h}>}
00006 
00007 \textcolor{preprocessor}{#ifndef INLINE}
00008 \textcolor{preprocessor}{#ifdef \_\_GNUC\_\_}
00009 \textcolor{preprocessor}{# define INLINE inline}
00010 \textcolor{preprocessor}{#else}
00011 \textcolor{preprocessor}{# define INLINE}
00012 \textcolor{preprocessor}{#endif}
00013 \textcolor{preprocessor}{#endif}
00014 
00029 \textcolor{keywordtype}{int}         E\_gquad(\textcolor{keywordtype}{int} L,
00030                     \textcolor{keywordtype}{int} l[3],
00031                     \hyperlink{group__energy__parameters_structvrna__param__s}{vrna\_param\_t} * P);
00032 
00033 \hyperlink{group__data__structures_ga31125aeace516926bf7f251f759b6126}{FLT\_OR\_DBL}  exp\_E\_gquad(\textcolor{keywordtype}{int} L,
00034                         \textcolor{keywordtype}{int} l[3],
00035                         \hyperlink{group__energy__parameters_structvrna__exp__param__s}{vrna\_exp\_param\_t} * pf);
00036 
00037 \textcolor{keywordtype}{int}         E\_gquad\_ali(\textcolor{keywordtype}{int} i,
00038                         \textcolor{keywordtype}{int} L,
00039                         \textcolor{keywordtype}{int} l[3],
00040                         \textcolor{keyword}{const} \textcolor{keywordtype}{short} **S,
00041                         \textcolor{keywordtype}{int} n\_seq,
00042                         \hyperlink{group__energy__parameters_structvrna__param__s}{vrna\_param\_t} * P);
00043 
00044 
00045 \textcolor{keywordtype}{void} E\_gquad\_ali\_en(\textcolor{keywordtype}{int} i,
00046                     \textcolor{keywordtype}{int} L,
00047                     \textcolor{keywordtype}{int} l[3],
00048                     \textcolor{keyword}{const} \textcolor{keywordtype}{short} **S,
00049                     \textcolor{keywordtype}{int} n\_seq,
00050                     \textcolor{keywordtype}{int} en[2],
00051                     \hyperlink{group__energy__parameters_structvrna__param__s}{vrna\_param\_t} * P);
00052 
00069 \textcolor{keywordtype}{int} *\hyperlink{group__gquads_ga392e45c9615aa123737671603fa4203c}{get\_gquad\_matrix}(\textcolor{keywordtype}{short}         *S,
00070                       \hyperlink{group__energy__parameters_structvrna__param__s}{vrna\_param\_t}  *P);
00071 
00072 
00073 \textcolor{keywordtype}{int} *get\_gquad\_ali\_matrix(\textcolor{keywordtype}{short}         *S\_cons,
00074                           \textcolor{keywordtype}{short}         **S,
00075                           \textcolor{keywordtype}{int}           n\_seq,
00076                           \hyperlink{group__energy__parameters_structvrna__param__s}{vrna\_param\_t}  *P);
00077 
00078 
00079 \hyperlink{group__data__structures_ga31125aeace516926bf7f251f759b6126}{FLT\_OR\_DBL} *get\_gquad\_pf\_matrix(\textcolor{keywordtype}{short}             *S,
00080                                 \hyperlink{group__data__structures_ga31125aeace516926bf7f251f759b6126}{FLT\_OR\_DBL}        *scale,
00081                                 \hyperlink{group__energy__parameters_structvrna__exp__param__s}{vrna\_exp\_param\_t}  *pf);
00082 
00083 
00084 \textcolor{keywordtype}{int} **get\_gquad\_L\_matrix(\textcolor{keywordtype}{short}        *S,
00085                          \textcolor{keywordtype}{int}          start,
00086                          \textcolor{keywordtype}{int}          maxdist,
00087                          \textcolor{keywordtype}{int}          n,
00088                          \textcolor{keywordtype}{int}          **g,
00089                          \hyperlink{group__energy__parameters_structvrna__param__s}{vrna\_param\_t} *P);
00090 
00091 
00092 \textcolor{keywordtype}{void}        vrna\_gquad\_mx\_local\_update(\hyperlink{group__fold__compound_structvrna__fc__s}{vrna\_fold\_compound\_t} *vc,
00093                                        \textcolor{keywordtype}{int}                  start);
00094 
00095 
00096 \textcolor{keywordtype}{void} get\_gquad\_pattern\_mfe(\textcolor{keywordtype}{short} *S,
00097                            \textcolor{keywordtype}{int} i,
00098                            \textcolor{keywordtype}{int} j,
00099                            \hyperlink{group__energy__parameters_structvrna__param__s}{vrna\_param\_t} * P,
00100                            \textcolor{keywordtype}{int} *L,
00101                            \textcolor{keywordtype}{int} l[3]);
00102 
00103 \textcolor{keywordtype}{void}
00104 get\_gquad\_pattern\_exhaustive(\textcolor{keywordtype}{short}        *S,
00105                              \textcolor{keywordtype}{int}          i,
00106                              \textcolor{keywordtype}{int}          j,
00107                              \hyperlink{group__energy__parameters_structvrna__param__s}{vrna\_param\_t} *P,
00108                              \textcolor{keywordtype}{int}          *L,
00109                              \textcolor{keywordtype}{int}          *l,
00110                              \textcolor{keywordtype}{int}          threshold);
00111 
00112 
00113 \textcolor{keywordtype}{void} get\_gquad\_pattern\_pf(\textcolor{keywordtype}{short} *S,
00114                           \textcolor{keywordtype}{int} i,
00115                           \textcolor{keywordtype}{int} j,
00116                           \hyperlink{group__energy__parameters_structvrna__exp__param__s}{vrna\_exp\_param\_t} * pf,
00117                           \textcolor{keywordtype}{int} *L,
00118                           \textcolor{keywordtype}{int} l[3]);
00119 
00120 \hyperlink{group__struct__utils_structvrna__elem__prob__s}{plist} *get\_plist\_gquad\_from\_pr(\textcolor{keywordtype}{short}            *S,
00121                                \textcolor{keywordtype}{int}              gi,
00122                                \textcolor{keywordtype}{int}              gj,
00123                                \hyperlink{group__data__structures_ga31125aeace516926bf7f251f759b6126}{FLT\_OR\_DBL}       *G,
00124                                \hyperlink{group__data__structures_ga31125aeace516926bf7f251f759b6126}{FLT\_OR\_DBL}       *probs,
00125                                \hyperlink{group__data__structures_ga31125aeace516926bf7f251f759b6126}{FLT\_OR\_DBL}       *scale,
00126                                \hyperlink{group__energy__parameters_structvrna__exp__param__s}{vrna\_exp\_param\_t} *pf);
00127 
00128 
00129 \hyperlink{group__struct__utils_structvrna__elem__prob__s}{plist} *get\_plist\_gquad\_from\_pr\_max(\textcolor{keywordtype}{short} *S,
00130                                    \textcolor{keywordtype}{int} gi,
00131                                    \textcolor{keywordtype}{int} gj,
00132                                    \hyperlink{group__data__structures_ga31125aeace516926bf7f251f759b6126}{FLT\_OR\_DBL} * G,
00133                                    \hyperlink{group__data__structures_ga31125aeace516926bf7f251f759b6126}{FLT\_OR\_DBL} * probs,
00134                                    \hyperlink{group__data__structures_ga31125aeace516926bf7f251f759b6126}{FLT\_OR\_DBL} * scale,
00135                                    \textcolor{keywordtype}{int} *L,
00136                                    \textcolor{keywordtype}{int} l[3],
00137                                    \hyperlink{group__energy__parameters_structvrna__exp__param__s}{vrna\_exp\_param\_t} * pf);
00138 
00139 \hyperlink{group__struct__utils_structvrna__elem__prob__s}{plist} *get\_plist\_gquad\_from\_db(\textcolor{keyword}{const} \textcolor{keywordtype}{char} *structure,
00140                                \textcolor{keywordtype}{float}      \hyperlink{fold__vars_8h_ac98ec419070aee6831b44e5c700f090f}{pr});
00141 
00142 
00143 \textcolor{keywordtype}{int}         get\_gquad\_count(\textcolor{keywordtype}{short} *S,
00144                             \textcolor{keywordtype}{int}   i,
00145                             \textcolor{keywordtype}{int}   j);
00146 
00147 
00148 \textcolor{keywordtype}{int}         get\_gquad\_layer\_count(\textcolor{keywordtype}{short} *S,
00149                                   \textcolor{keywordtype}{int}   i,
00150                                   \textcolor{keywordtype}{int}   j);
00151 
00152 
00153 \textcolor{keywordtype}{void} get\_gquad\_pattern\_mfe\_ali(\textcolor{keywordtype}{short} **S,
00154                                \textcolor{keywordtype}{short} *S\_cons,
00155                                \textcolor{keywordtype}{int} n\_seq,
00156                                \textcolor{keywordtype}{int} i,
00157                                \textcolor{keywordtype}{int} j,
00158                                \hyperlink{group__energy__parameters_structvrna__param__s}{vrna\_param\_t} * P,
00159                                \textcolor{keywordtype}{int} *L,
00160                                \textcolor{keywordtype}{int} l[3]);
00161 
00172 \textcolor{keywordtype}{int} \hyperlink{group__gquads_gae41763215b9c64d2a7b67f0df8a28078}{parse\_gquad}(\textcolor{keyword}{const} \textcolor{keywordtype}{char} *struc, \textcolor{keywordtype}{int} *L, \textcolor{keywordtype}{int} l[3]);
00173 
00174 INLINE PRIVATE \textcolor{keywordtype}{int} \hyperlink{group__gquads_ga220c41e8dbcee940ac975b8ce88e55c5}{backtrack\_GQuad\_IntLoop}(\textcolor{keywordtype}{int}          c,
00175                                            \textcolor{keywordtype}{int}          i,
00176                                            \textcolor{keywordtype}{int}          j,
00177                                            \textcolor{keywordtype}{int}          type,
00178                                            \textcolor{keywordtype}{short}        *S,
00179                                            \textcolor{keywordtype}{int}          *ggg,
00180                                            \textcolor{keywordtype}{int}          *index,
00181                                            \textcolor{keywordtype}{int}          *p,
00182                                            \textcolor{keywordtype}{int}          *q,
00183                                            \hyperlink{group__energy__parameters_structvrna__param__s}{vrna\_param\_t} *P);
00184 
00185 
00186 INLINE PRIVATE \textcolor{keywordtype}{int} backtrack\_GQuad\_IntLoop\_comparative(\textcolor{keywordtype}{int}          c,
00187                                                        \textcolor{keywordtype}{int}          i,
00188                                                        \textcolor{keywordtype}{int}          j,
00189                                                        \textcolor{keywordtype}{int}          *type,
00190                                                        \textcolor{keywordtype}{short}        *S\_cons,
00191                                                        \textcolor{keywordtype}{short}        **S5,
00192                                                        \textcolor{keywordtype}{short}        **S3,
00193                                                        \textcolor{keywordtype}{int}          *ggg,
00194                                                        \textcolor{keywordtype}{int}          *index,
00195                                                        \textcolor{keywordtype}{int}          *p,
00196                                                        \textcolor{keywordtype}{int}          *q,
00197                                                        \textcolor{keywordtype}{int}          n\_seq,
00198                                                        \hyperlink{group__energy__parameters_structvrna__param__s}{vrna\_param\_t} *P);
00199 
00200 
00201 INLINE PRIVATE \textcolor{keywordtype}{int} \hyperlink{group__gquads_ga7b371308fa5a45c7ac353ef6ed1014de}{backtrack\_GQuad\_IntLoop\_L}(\textcolor{keywordtype}{int}          c,
00202                                              \textcolor{keywordtype}{int}          i,
00203                                              \textcolor{keywordtype}{int}          j,
00204                                              \textcolor{keywordtype}{int}          type,
00205                                              \textcolor{keywordtype}{short}        *S,
00206                                              \textcolor{keywordtype}{int}          **ggg,
00207                                              \textcolor{keywordtype}{int}          maxdist,
00208                                              \textcolor{keywordtype}{int}          *p,
00209                                              \textcolor{keywordtype}{int}          *q,
00210                                              \hyperlink{group__energy__parameters_structvrna__param__s}{vrna\_param\_t} *P);
00211 
00212 
00213 PRIVATE INLINE \textcolor{keywordtype}{int}
00214 vrna\_BT\_gquad\_int(\hyperlink{group__fold__compound_structvrna__fc__s}{vrna\_fold\_compound\_t}  *vc,
00215                   \textcolor{keywordtype}{int}                   i,
00216                   \textcolor{keywordtype}{int}                   j,
00217                   \textcolor{keywordtype}{int}                   en,
00218                   \hyperlink{group__data__structures_structvrna__bp__stack__s}{vrna\_bp\_stack\_t}       *bp\_stack,
00219                   \textcolor{keywordtype}{int}                   *stack\_count);
00220 
00221 
00222 PRIVATE INLINE \textcolor{keywordtype}{int}
00223 vrna\_BT\_gquad\_mfe(\hyperlink{group__fold__compound_structvrna__fc__s}{vrna\_fold\_compound\_t}  *vc,
00224                   \textcolor{keywordtype}{int}                   i,
00225                   \textcolor{keywordtype}{int}                   j,
00226                   \hyperlink{group__data__structures_structvrna__bp__stack__s}{vrna\_bp\_stack\_t}       *bp\_stack,
00227                   \textcolor{keywordtype}{int}                   *stack\_count)
00228 \{
00229   \textcolor{comment}{/*}
00230 \textcolor{comment}{   * here we do some fancy stuff to backtrace the stacksize and linker lengths}
00231 \textcolor{comment}{   * of the g-quadruplex that should reside within position i,j}
00232 \textcolor{comment}{   */}
00233   \textcolor{keywordtype}{short}         *S;
00234   \textcolor{keywordtype}{int}           l[3], L, a, n\_seq;
00235   \hyperlink{group__energy__parameters_structvrna__param__s}{vrna\_param\_t}  *P;
00236 
00237   \textcolor{keywordflow}{if} (vc) \{
00238     P = vc->\hyperlink{group__fold__compound_a19b8720c2c5321c1b97c830bd17566ea}{params};
00239     \textcolor{keywordflow}{switch} (vc->\hyperlink{group__fold__compound_ac5eab693deac9a1a40c2a95ac294707c}{type}) \{
00240       \textcolor{keywordflow}{case} \hyperlink{group__fold__compound_gga01a4ff86fa71deaaa5d1abbd95a1447da7e264dd3cf2dc9b6448caabcb7763cd6}{VRNA\_FC\_TYPE\_SINGLE}:
00241         S = vc->sequence\_encoding2;
00242         L = -1;
00243 
00244         get\_gquad\_pattern\_mfe(S, i, j, P, &L, l);
00245         \textcolor{keywordflow}{break};
00246 
00247       \textcolor{keywordflow}{case} \hyperlink{group__fold__compound_gga01a4ff86fa71deaaa5d1abbd95a1447dab821ce46ea3cf665be97df22a76f5023}{VRNA\_FC\_TYPE\_COMPARATIVE}:
00248         n\_seq = vc->\hyperlink{group__fold__compound_a614702ab74478e786272be44f8cebfe3}{n\_seq};
00249         L     = -1;
00250         get\_gquad\_pattern\_mfe\_ali(vc->\hyperlink{group__fold__compound_aebb37297f92c7bd22aac6343f8f61d61}{S}, vc->\hyperlink{group__fold__compound_aa3fab7ae38ebfed2028375221d295686}{S\_cons}, n\_seq, i, j, P, &L, l);
00251         \textcolor{keywordflow}{break};
00252     \}
00253 
00254     \textcolor{keywordflow}{if} (L != -1) \{
00255       \textcolor{comment}{/* fill the G's of the quadruplex into base\_pair2 */}
00256       \textcolor{keywordflow}{for} (a = 0; a < L; a++) \{
00257         bp\_stack[++(*stack\_count)].i  = i + a;
00258         bp\_stack[(*stack\_count)].j    = i + a;
00259         bp\_stack[++(*stack\_count)].i  = i + L + l[0] + a;
00260         bp\_stack[(*stack\_count)].j    = i + L + l[0] + a;
00261         bp\_stack[++(*stack\_count)].i  = i + L + l[0] + L + l[1] + a;
00262         bp\_stack[(*stack\_count)].j    = i + L + l[0] + L + l[1] + a;
00263         bp\_stack[++(*stack\_count)].i  = i + L + l[0] + L + l[1] + L + l[2] + a;
00264         bp\_stack[(*stack\_count)].j    = i + L + l[0] + L + l[1] + L + l[2] + a;
00265       \}
00266       \textcolor{keywordflow}{return} 1;
00267     \} \textcolor{keywordflow}{else} \{
00268       \textcolor{keywordflow}{return} 0;
00269     \}
00270   \}
00271 
00272   \textcolor{keywordflow}{return} 0;
00273 \}
00274 
00275 
00276 PRIVATE INLINE \textcolor{keywordtype}{int}
00277 vrna\_BT\_gquad\_int(\hyperlink{group__fold__compound_structvrna__fc__s}{vrna\_fold\_compound\_t}  *vc,
00278                   \textcolor{keywordtype}{int}                   i,
00279                   \textcolor{keywordtype}{int}                   j,
00280                   \textcolor{keywordtype}{int}                   en,
00281                   \hyperlink{group__data__structures_structvrna__bp__stack__s}{vrna\_bp\_stack\_t}       *bp\_stack,
00282                   \textcolor{keywordtype}{int}                   *stack\_count)
00283 \{
00284   \textcolor{keywordtype}{int}           energy, \hyperlink{group__model__details_ga72b511ed1201f7e23ec437e468790d74}{dangles}, *idx, ij, p, q, maxl, minl, c0, l1, *rtype, *ggg;
00285   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} type;
00286   \textcolor{keywordtype}{char}          *ptype;
00287   \textcolor{keywordtype}{short}         si, sj, *S, *S1;
00288 
00289   \hyperlink{group__energy__parameters_structvrna__param__s}{vrna\_param\_t}  *P;
00290   \hyperlink{group__model__details_structvrna__md__s}{vrna\_md\_t}     *md;
00291 
00292   idx     = vc->\hyperlink{group__fold__compound_a5037235dee512efd85ca543780bbca1a}{jindx};
00293   ij      = idx[j] + i;
00294   P       = vc->\hyperlink{group__fold__compound_a19b8720c2c5321c1b97c830bd17566ea}{params};
00295   md      = &(P->\hyperlink{group__energy__parameters_a7b84353eb9075c595bad4ceb871bcae7}{model\_details});
00296   ptype   = vc->\hyperlink{group__fold__compound_a3fbea559f1d1976b2d67c215cdeee0b2}{ptype};
00297   rtype   = &(md->\hyperlink{group__model__details_ad082d0fea31e002b90cdfe5e6382f8b0}{rtype}[0]);
00298   type    = rtype[(\textcolor{keywordtype}{unsigned} char)ptype[ij]];
00299   S1      = vc->\hyperlink{group__fold__compound_a9934bdb695d35a3544285cbcc19f9763}{sequence\_encoding};
00300   S       = vc->sequence\_encoding2;
00301   dangles = md->\hyperlink{group__model__details_adcda4ff2ea77748ae0e8700288282efc}{dangles};
00302   si      = S1[i + 1];
00303   sj      = S1[j - 1];
00304   ggg     = vc->\hyperlink{group__fold__compound_aca8be7bdc65bafe2172c6ee777f18568}{matrices}->\hyperlink{group__dp__matrices_a0b7b86a5c75c96eabb89eb53a13e7164}{ggg};
00305   energy  = 0;
00306 
00307   \textcolor{keywordflow}{if} (dangles == 2)
00308     energy += P->mismatchI[type][si][sj];
00309 
00310   \textcolor{keywordflow}{if} (type > 2)
00311     energy += P->TerminalAU;
00312 
00313   p = i + 1;
00314   \textcolor{keywordflow}{if} (S1[p] == 3) \{
00315     \textcolor{keywordflow}{if} (p < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE) \{
00316       minl  = j - i + p - \hyperlink{energy__const_8h_ad1bd6eabac419670ddd3c9ed82145988}{MAXLOOP} - 2;
00317       c0    = p + VRNA\_GQUAD\_MIN\_BOX\_SIZE - 1;
00318       minl  = \hyperlink{group__utils_ga33297b3679c713b0c4d897cd0fe3b122}{MAX2}(c0, minl);
00319       c0    = j - 3;
00320       maxl  = p + VRNA\_GQUAD\_MAX\_BOX\_SIZE + 1;
00321       maxl  = \hyperlink{group__utils_gae0b9cd0ce090bd69b951aa73e8fa4f7d}{MIN2}(c0, maxl);
00322       \textcolor{keywordflow}{for} (q = minl; q < maxl; q++) \{
00323         \textcolor{keywordflow}{if} (S[q] != 3)
00324           \textcolor{keywordflow}{continue};
00325 
00326         \textcolor{keywordflow}{if} (en == energy + ggg[idx[q] + p] + P->internal\_loop[j - q - 1])
00327           \textcolor{keywordflow}{return} vrna\_BT\_gquad\_mfe(vc, p, q, bp\_stack, stack\_count);
00328       \}
00329     \}
00330   \}
00331 
00332   \textcolor{keywordflow}{for} (p = i + 2;
00333        p < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE;
00334        p++) \{
00335     l1 = p - i - 1;
00336     \textcolor{keywordflow}{if} (l1 > MAXLOOP)
00337       \textcolor{keywordflow}{break};
00338 
00339     \textcolor{keywordflow}{if} (S1[p] != 3)
00340       \textcolor{keywordflow}{continue};
00341 
00342     minl  = j - i + p - MAXLOOP - 2;
00343     c0    = p + VRNA\_GQUAD\_MIN\_BOX\_SIZE - 1;
00344     minl  = \hyperlink{group__utils_ga33297b3679c713b0c4d897cd0fe3b122}{MAX2}(c0, minl);
00345     c0    = j - 1;
00346     maxl  = p + VRNA\_GQUAD\_MAX\_BOX\_SIZE + 1;
00347     maxl  = \hyperlink{group__utils_gae0b9cd0ce090bd69b951aa73e8fa4f7d}{MIN2}(c0, maxl);
00348     \textcolor{keywordflow}{for} (q = minl; q < maxl; q++) \{
00349       \textcolor{keywordflow}{if} (S1[q] != 3)
00350         \textcolor{keywordflow}{continue};
00351 
00352       \textcolor{keywordflow}{if} (en == energy + ggg[idx[q] + p] + P->internal\_loop[l1 + j - q - 1])
00353         \textcolor{keywordflow}{return} vrna\_BT\_gquad\_mfe(vc, p, q, bp\_stack, stack\_count);
00354     \}
00355   \}
00356 
00357   q = j - 1;
00358   \textcolor{keywordflow}{if} (S1[q] == 3)
00359     \textcolor{keywordflow}{for} (p = i + 4;
00360          p < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE;
00361          p++) \{
00362       l1 = p - i - 1;
00363       \textcolor{keywordflow}{if} (l1 > MAXLOOP)
00364         \textcolor{keywordflow}{break};
00365 
00366       \textcolor{keywordflow}{if} (S1[p] != 3)
00367         \textcolor{keywordflow}{continue};
00368 
00369       \textcolor{keywordflow}{if} (en == energy + ggg[idx[q] + p] + P->internal\_loop[l1])
00370         \textcolor{keywordflow}{return} vrna\_BT\_gquad\_mfe(vc, p, q, bp\_stack, stack\_count);
00371     \}
00372 
00373   \textcolor{keywordflow}{return} 0;
00374 \}
00375 
00376 
00394 INLINE PRIVATE \textcolor{keywordtype}{int}
\Hypertarget{gquad_8h_source_l00395}\hyperlink{group__gquads_ga220c41e8dbcee940ac975b8ce88e55c5}{00395} \hyperlink{group__gquads_ga220c41e8dbcee940ac975b8ce88e55c5}{backtrack\_GQuad\_IntLoop}(\textcolor{keywordtype}{int}           c,
00396                         \textcolor{keywordtype}{int}           i,
00397                         \textcolor{keywordtype}{int}           j,
00398                         \textcolor{keywordtype}{int}           type,
00399                         \textcolor{keywordtype}{short}         *S,
00400                         \textcolor{keywordtype}{int}           *ggg,
00401                         \textcolor{keywordtype}{int}           *index,
00402                         \textcolor{keywordtype}{int}           *p,
00403                         \textcolor{keywordtype}{int}           *q,
00404                         \hyperlink{group__energy__parameters_structvrna__param__s}{vrna\_param\_t}  *P)
00405 \{
00406   \textcolor{keywordtype}{int}   energy, \hyperlink{group__model__details_ga72b511ed1201f7e23ec437e468790d74}{dangles}, k, l, maxl, minl, c0, l1;
00407   \textcolor{keywordtype}{short} si, sj;
00408 
00409   dangles = P->\hyperlink{group__energy__parameters_a7b84353eb9075c595bad4ceb871bcae7}{model\_details}.\hyperlink{group__model__details_adcda4ff2ea77748ae0e8700288282efc}{dangles};
00410   si      = S[i + 1];
00411   sj      = S[j - 1];
00412   energy  = 0;
00413 
00414   \textcolor{keywordflow}{if} (dangles == 2)
00415     energy += P->mismatchI[type][si][sj];
00416 
00417   \textcolor{keywordflow}{if} (type > 2)
00418     energy += P->TerminalAU;
00419 
00420   k = i + 1;
00421   \textcolor{keywordflow}{if} (S[k] == 3) \{
00422     \textcolor{keywordflow}{if} (k < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE) \{
00423       minl  = j - i + k - MAXLOOP - 2;
00424       c0    = k + VRNA\_GQUAD\_MIN\_BOX\_SIZE - 1;
00425       minl  = \hyperlink{group__utils_ga33297b3679c713b0c4d897cd0fe3b122}{MAX2}(c0, minl);
00426       c0    = j - 3;
00427       maxl  = k + VRNA\_GQUAD\_MAX\_BOX\_SIZE + 1;
00428       maxl  = \hyperlink{group__utils_gae0b9cd0ce090bd69b951aa73e8fa4f7d}{MIN2}(c0, maxl);
00429       \textcolor{keywordflow}{for} (l = minl; l < maxl; l++) \{
00430         \textcolor{keywordflow}{if} (S[l] != 3)
00431           \textcolor{keywordflow}{continue};
00432 
00433         \textcolor{keywordflow}{if} (c == energy + ggg[index[l] + k] + P->internal\_loop[j - l - 1]) \{
00434           *p  = k;
00435           *q  = l;
00436           \textcolor{keywordflow}{return} 1;
00437         \}
00438       \}
00439     \}
00440   \}
00441 
00442   \textcolor{keywordflow}{for} (k = i + 2;
00443        k < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE;
00444        k++) \{
00445     l1 = k - i - 1;
00446     \textcolor{keywordflow}{if} (l1 > MAXLOOP)
00447       \textcolor{keywordflow}{break};
00448 
00449     \textcolor{keywordflow}{if} (S[k] != 3)
00450       \textcolor{keywordflow}{continue};
00451 
00452     minl  = j - i + k - MAXLOOP - 2;
00453     c0    = k + VRNA\_GQUAD\_MIN\_BOX\_SIZE - 1;
00454     minl  = \hyperlink{group__utils_ga33297b3679c713b0c4d897cd0fe3b122}{MAX2}(c0, minl);
00455     c0    = j - 1;
00456     maxl  = k + VRNA\_GQUAD\_MAX\_BOX\_SIZE + 1;
00457     maxl  = \hyperlink{group__utils_gae0b9cd0ce090bd69b951aa73e8fa4f7d}{MIN2}(c0, maxl);
00458     \textcolor{keywordflow}{for} (l = minl; l < maxl; l++) \{
00459       \textcolor{keywordflow}{if} (S[l] != 3)
00460         \textcolor{keywordflow}{continue};
00461 
00462       \textcolor{keywordflow}{if} (c == energy + ggg[index[l] + k] + P->internal\_loop[l1 + j - l - 1]) \{
00463         *p  = k;
00464         *q  = l;
00465         \textcolor{keywordflow}{return} 1;
00466       \}
00467     \}
00468   \}
00469 
00470   l = j - 1;
00471   \textcolor{keywordflow}{if} (S[l] == 3)
00472     \textcolor{keywordflow}{for} (k = i + 4;
00473          k < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE;
00474          k++) \{
00475       l1 = k - i - 1;
00476       \textcolor{keywordflow}{if} (l1 > MAXLOOP)
00477         \textcolor{keywordflow}{break};
00478 
00479       \textcolor{keywordflow}{if} (S[k] != 3)
00480         \textcolor{keywordflow}{continue};
00481 
00482       \textcolor{keywordflow}{if} (c == energy + ggg[index[l] + k] + P->internal\_loop[l1]) \{
00483         *p  = k;
00484         *q  = l;
00485         \textcolor{keywordflow}{return} 1;
00486       \}
00487     \}
00488 
00489   \textcolor{keywordflow}{return} 0;
00490 \}
00491 
00492 
00493 INLINE PRIVATE \textcolor{keywordtype}{int}
00494 backtrack\_GQuad\_IntLoop\_comparative(\textcolor{keywordtype}{int}           c,
00495                                     \textcolor{keywordtype}{int}           i,
00496                                     \textcolor{keywordtype}{int}           j,
00497                                     \textcolor{keywordtype}{int}           *type,
00498                                     \textcolor{keywordtype}{short}         *S\_cons,
00499                                     \textcolor{keywordtype}{short}         **S5,
00500                                     \textcolor{keywordtype}{short}         **S3,
00501                                     \textcolor{keywordtype}{int}           *ggg,
00502                                     \textcolor{keywordtype}{int}           *index,
00503                                     \textcolor{keywordtype}{int}           *p,
00504                                     \textcolor{keywordtype}{int}           *q,
00505                                     \textcolor{keywordtype}{int}           n\_seq,
00506                                     \hyperlink{group__energy__parameters_structvrna__param__s}{vrna\_param\_t}  *P)
00507 \{
00508   \textcolor{keywordtype}{int} energy, \hyperlink{group__model__details_ga72b511ed1201f7e23ec437e468790d74}{dangles}, k, l, maxl, minl, c0, l1, ss, tt;
00509 
00510   dangles = P->\hyperlink{group__energy__parameters_a7b84353eb9075c595bad4ceb871bcae7}{model\_details}.\hyperlink{group__model__details_adcda4ff2ea77748ae0e8700288282efc}{dangles};
00511   energy  = 0;
00512 
00513   \textcolor{keywordflow}{for} (ss = 0; ss < n\_seq; ss++) \{
00514     tt = type[ss];
00515     \textcolor{keywordflow}{if} (tt == 0)
00516       tt = 7;
00517 
00518     \textcolor{keywordflow}{if} (dangles == 2)
00519       energy += P->mismatchI[tt][S3[ss][i]][S5[ss][j]];
00520 
00521     \textcolor{keywordflow}{if} (tt > 2)
00522       energy += P->TerminalAU;
00523   \}
00524 
00525   k = i + 1;
00526   \textcolor{keywordflow}{if} (S\_cons[k] == 3) \{
00527     \textcolor{keywordflow}{if} (k < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE) \{
00528       minl  = j - i + k - MAXLOOP - 2;
00529       c0    = k + VRNA\_GQUAD\_MIN\_BOX\_SIZE - 1;
00530       minl  = \hyperlink{group__utils_ga33297b3679c713b0c4d897cd0fe3b122}{MAX2}(c0, minl);
00531       c0    = j - 3;
00532       maxl  = k + VRNA\_GQUAD\_MAX\_BOX\_SIZE + 1;
00533       maxl  = \hyperlink{group__utils_gae0b9cd0ce090bd69b951aa73e8fa4f7d}{MIN2}(c0, maxl);
00534       \textcolor{keywordflow}{for} (l = minl; l < maxl; l++) \{
00535         \textcolor{keywordflow}{if} (S\_cons[l] != 3)
00536           \textcolor{keywordflow}{continue};
00537 
00538         \textcolor{keywordflow}{if} (c == energy + ggg[index[l] + k] + n\_seq * P->internal\_loop[j - l - 1]) \{
00539           *p  = k;
00540           *q  = l;
00541           \textcolor{keywordflow}{return} 1;
00542         \}
00543       \}
00544     \}
00545   \}
00546 
00547   \textcolor{keywordflow}{for} (k = i + 2;
00548        k < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE;
00549        k++) \{
00550     l1 = k - i - 1;
00551     \textcolor{keywordflow}{if} (l1 > MAXLOOP)
00552       \textcolor{keywordflow}{break};
00553 
00554     \textcolor{keywordflow}{if} (S\_cons[k] != 3)
00555       \textcolor{keywordflow}{continue};
00556 
00557     minl  = j - i + k - MAXLOOP - 2;
00558     c0    = k + VRNA\_GQUAD\_MIN\_BOX\_SIZE - 1;
00559     minl  = \hyperlink{group__utils_ga33297b3679c713b0c4d897cd0fe3b122}{MAX2}(c0, minl);
00560     c0    = j - 1;
00561     maxl  = k + VRNA\_GQUAD\_MAX\_BOX\_SIZE + 1;
00562     maxl  = \hyperlink{group__utils_gae0b9cd0ce090bd69b951aa73e8fa4f7d}{MIN2}(c0, maxl);
00563     \textcolor{keywordflow}{for} (l = minl; l < maxl; l++) \{
00564       \textcolor{keywordflow}{if} (S\_cons[l] != 3)
00565         \textcolor{keywordflow}{continue};
00566 
00567       \textcolor{keywordflow}{if} (c == energy + ggg[index[l] + k] + n\_seq * P->internal\_loop[l1 + j - l - 1]) \{
00568         *p  = k;
00569         *q  = l;
00570         \textcolor{keywordflow}{return} 1;
00571       \}
00572     \}
00573   \}
00574 
00575   l = j - 1;
00576   \textcolor{keywordflow}{if} (S\_cons[l] == 3)
00577     \textcolor{keywordflow}{for} (k = i + 4;
00578          k < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE;
00579          k++) \{
00580       l1 = k - i - 1;
00581       \textcolor{keywordflow}{if} (l1 > MAXLOOP)
00582         \textcolor{keywordflow}{break};
00583 
00584       \textcolor{keywordflow}{if} (S\_cons[k] != 3)
00585         \textcolor{keywordflow}{continue};
00586 
00587       \textcolor{keywordflow}{if} (c == energy + ggg[index[l] + k] + n\_seq * P->internal\_loop[l1]) \{
00588         *p  = k;
00589         *q  = l;
00590         \textcolor{keywordflow}{return} 1;
00591       \}
00592     \}
00593 
00594   \textcolor{keywordflow}{return} 0;
00595 \}
00596 
00597 
00614 INLINE PRIVATE \textcolor{keywordtype}{int}
\Hypertarget{gquad_8h_source_l00615}\hyperlink{group__gquads_ga7b371308fa5a45c7ac353ef6ed1014de}{00615} \hyperlink{group__gquads_ga7b371308fa5a45c7ac353ef6ed1014de}{backtrack\_GQuad\_IntLoop\_L}(\textcolor{keywordtype}{int}           c,
00616                           \textcolor{keywordtype}{int}           i,
00617                           \textcolor{keywordtype}{int}           j,
00618                           \textcolor{keywordtype}{int}           type,
00619                           \textcolor{keywordtype}{short}         *S,
00620                           \textcolor{keywordtype}{int}           **ggg,
00621                           \textcolor{keywordtype}{int}           maxdist,
00622                           \textcolor{keywordtype}{int}           *p,
00623                           \textcolor{keywordtype}{int}           *q,
00624                           \hyperlink{group__energy__parameters_structvrna__param__s}{vrna\_param\_t}  *P)
00625 \{
00626   \textcolor{keywordtype}{int}   energy, \hyperlink{group__model__details_ga72b511ed1201f7e23ec437e468790d74}{dangles}, k, l, maxl, minl, c0, l1;
00627   \textcolor{keywordtype}{short} si, sj;
00628 
00629   dangles = P->\hyperlink{group__energy__parameters_a7b84353eb9075c595bad4ceb871bcae7}{model\_details}.\hyperlink{group__model__details_adcda4ff2ea77748ae0e8700288282efc}{dangles};
00630   si      = S[i + 1];
00631   sj      = S[j - 1];
00632   energy  = 0;
00633 
00634   \textcolor{keywordflow}{if} (dangles == 2)
00635     energy += P->mismatchI[type][si][sj];
00636 
00637   \textcolor{keywordflow}{if} (type > 2)
00638     energy += P->TerminalAU;
00639 
00640   k = i + 1;
00641   \textcolor{keywordflow}{if} (S[k] == 3) \{
00642     \textcolor{keywordflow}{if} (k < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE) \{
00643       minl  = j - i + k - MAXLOOP - 2;
00644       c0    = k + VRNA\_GQUAD\_MIN\_BOX\_SIZE - 1;
00645       minl  = \hyperlink{group__utils_ga33297b3679c713b0c4d897cd0fe3b122}{MAX2}(c0, minl);
00646       c0    = j - 3;
00647       maxl  = k + VRNA\_GQUAD\_MAX\_BOX\_SIZE + 1;
00648       maxl  = \hyperlink{group__utils_gae0b9cd0ce090bd69b951aa73e8fa4f7d}{MIN2}(c0, maxl);
00649       \textcolor{keywordflow}{for} (l = minl; l < maxl; l++) \{
00650         \textcolor{keywordflow}{if} (S[l] != 3)
00651           \textcolor{keywordflow}{continue};
00652 
00653         \textcolor{keywordflow}{if} (c == energy + ggg[k][l - k] + P->internal\_loop[j - l - 1]) \{
00654           *p  = k;
00655           *q  = l;
00656           \textcolor{keywordflow}{return} 1;
00657         \}
00658       \}
00659     \}
00660   \}
00661 
00662   \textcolor{keywordflow}{for} (k = i + 2;
00663        k < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE;
00664        k++) \{
00665     l1 = k - i - 1;
00666     \textcolor{keywordflow}{if} (l1 > MAXLOOP)
00667       \textcolor{keywordflow}{break};
00668 
00669     \textcolor{keywordflow}{if} (S[k] != 3)
00670       \textcolor{keywordflow}{continue};
00671 
00672     minl  = j - i + k - MAXLOOP - 2;
00673     c0    = k + VRNA\_GQUAD\_MIN\_BOX\_SIZE - 1;
00674     minl  = \hyperlink{group__utils_ga33297b3679c713b0c4d897cd0fe3b122}{MAX2}(c0, minl);
00675     c0    = j - 1;
00676     maxl  = k + VRNA\_GQUAD\_MAX\_BOX\_SIZE + 1;
00677     maxl  = \hyperlink{group__utils_gae0b9cd0ce090bd69b951aa73e8fa4f7d}{MIN2}(c0, maxl);
00678     \textcolor{keywordflow}{for} (l = minl; l < maxl; l++) \{
00679       \textcolor{keywordflow}{if} (S[l] != 3)
00680         \textcolor{keywordflow}{continue};
00681 
00682       \textcolor{keywordflow}{if} (c == energy + ggg[k][l - k] + P->internal\_loop[l1 + j - l - 1]) \{
00683         *p  = k;
00684         *q  = l;
00685         \textcolor{keywordflow}{return} 1;
00686       \}
00687     \}
00688   \}
00689 
00690   l = j - 1;
00691   \textcolor{keywordflow}{if} (S[l] == 3)
00692     \textcolor{keywordflow}{for} (k = i + 4;
00693          k < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE;
00694          k++) \{
00695       l1 = k - i - 1;
00696       \textcolor{keywordflow}{if} (l1 > MAXLOOP)
00697         \textcolor{keywordflow}{break};
00698 
00699       \textcolor{keywordflow}{if} (S[k] != 3)
00700         \textcolor{keywordflow}{continue};
00701 
00702       \textcolor{keywordflow}{if} (c == energy + ggg[k][l - k] + P->internal\_loop[l1]) \{
00703         *p  = k;
00704         *q  = l;
00705         \textcolor{keywordflow}{return} 1;
00706       \}
00707     \}
00708 
00709   \textcolor{keywordflow}{return} 0;
00710 \}
00711 
00712 
00713 INLINE PRIVATE \textcolor{keywordtype}{int}
00714 backtrack\_GQuad\_IntLoop\_L\_comparative(\textcolor{keywordtype}{int}           c,
00715                                       \textcolor{keywordtype}{int}           i,
00716                                       \textcolor{keywordtype}{int}           j,
00717                                       \textcolor{keywordtype}{int}           *type,
00718                                       \textcolor{keywordtype}{short}         *S\_cons,
00719                                       \textcolor{keywordtype}{short}         **S5,
00720                                       \textcolor{keywordtype}{short}         **S3,
00721                                       \textcolor{keywordtype}{int}           **ggg,
00722                                       \textcolor{keywordtype}{int}           *p,
00723                                       \textcolor{keywordtype}{int}           *q,
00724                                       \textcolor{keywordtype}{int}           n\_seq,
00725                                       \hyperlink{group__energy__parameters_structvrna__param__s}{vrna\_param\_t}  *P)
00726 \{
00727   \textcolor{comment}{/*}
00728 \textcolor{comment}{   * The case that is handled here actually resembles something like}
00729 \textcolor{comment}{   * an interior loop where the enclosing base pair is of regular}
00730 \textcolor{comment}{   * kind and the enclosed pair is not a canonical one but a g-quadruplex}
00731 \textcolor{comment}{   * that should then be decomposed further...}
00732 \textcolor{comment}{   */}
00733   \textcolor{keywordtype}{int} mm, dangle\_model, k, l, maxl, minl, c0, l1, ss, tt;
00734 
00735   dangle\_model = P->\hyperlink{group__energy__parameters_a7b84353eb9075c595bad4ceb871bcae7}{model\_details}.\hyperlink{group__model__details_adcda4ff2ea77748ae0e8700288282efc}{dangles};
00736 
00737   mm = 0;
00738   \textcolor{keywordflow}{for} (ss = 0; ss < n\_seq; ss++) \{
00739     tt = type[ss];
00740 
00741     \textcolor{keywordflow}{if} (dangle\_model == 2)
00742       mm += P->mismatchI[tt][S3[ss][i]][S5[ss][j]];
00743 
00744     \textcolor{keywordflow}{if} (tt > 2)
00745       mm += P->TerminalAU;
00746   \}
00747 
00748   \textcolor{keywordflow}{for} (k = i + 2;
00749        k < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE;
00750        k++) \{
00751     \textcolor{keywordflow}{if} (S\_cons[k] != 3)
00752       \textcolor{keywordflow}{continue};
00753 
00754     l1 = k - i - 1;
00755     \textcolor{keywordflow}{if} (l1 > MAXLOOP)
00756       \textcolor{keywordflow}{break};
00757 
00758     minl  = j - i + k - MAXLOOP - 2;
00759     c0    = k + VRNA\_GQUAD\_MIN\_BOX\_SIZE - 1;
00760     minl  = \hyperlink{group__utils_ga33297b3679c713b0c4d897cd0fe3b122}{MAX2}(c0, minl);
00761     c0    = j - 1;
00762     maxl  = k + VRNA\_GQUAD\_MAX\_BOX\_SIZE + 1;
00763     maxl  = \hyperlink{group__utils_gae0b9cd0ce090bd69b951aa73e8fa4f7d}{MIN2}(c0, maxl);
00764     \textcolor{keywordflow}{for} (l = minl; l < maxl; l++) \{
00765       \textcolor{keywordflow}{if} (S\_cons[l] != 3)
00766         \textcolor{keywordflow}{continue};
00767 
00768       c0 = mm + ggg[k][l - k] + n\_seq * P->internal\_loop[l1 + j - l - 1];
00769       \textcolor{keywordflow}{if} (c == c0) \{
00770         *p  = k;
00771         *q  = l;
00772         \textcolor{keywordflow}{return} 1;
00773       \}
00774     \}
00775   \}
00776   k = i + 1;
00777   \textcolor{keywordflow}{if} (S\_cons[k] == 3) \{
00778     \textcolor{keywordflow}{if} (k < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE) \{
00779       minl  = j - i + k - MAXLOOP - 2;
00780       c0    = k + VRNA\_GQUAD\_MIN\_BOX\_SIZE - 1;
00781       minl  = \hyperlink{group__utils_ga33297b3679c713b0c4d897cd0fe3b122}{MAX2}(c0, minl);
00782       c0    = j - 3;
00783       maxl  = k + VRNA\_GQUAD\_MAX\_BOX\_SIZE + 1;
00784       maxl  = \hyperlink{group__utils_gae0b9cd0ce090bd69b951aa73e8fa4f7d}{MIN2}(c0, maxl);
00785       \textcolor{keywordflow}{for} (l = minl; l < maxl; l++) \{
00786         \textcolor{keywordflow}{if} (S\_cons[l] != 3)
00787           \textcolor{keywordflow}{continue};
00788 
00789         \textcolor{keywordflow}{if} (c == mm + ggg[k][l - k] + n\_seq * P->internal\_loop[j - l - 1]) \{
00790           *p  = k;
00791           *q  = l;
00792           \textcolor{keywordflow}{return} 1;
00793         \}
00794       \}
00795     \}
00796   \}
00797 
00798   l = j - 1;
00799   \textcolor{keywordflow}{if} (S\_cons[l] == 3) \{
00800     \textcolor{keywordflow}{for} (k = i + 4; k < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE; k++) \{
00801       l1 = k - i - 1;
00802       \textcolor{keywordflow}{if} (l1 > MAXLOOP)
00803         \textcolor{keywordflow}{break};
00804 
00805       \textcolor{keywordflow}{if} (S\_cons[k] != 3)
00806         \textcolor{keywordflow}{continue};
00807 
00808       \textcolor{keywordflow}{if} (c == mm + ggg[k][l - k] + n\_seq * P->internal\_loop[l1]) \{
00809         *p  = k;
00810         *q  = l;
00811         \textcolor{keywordflow}{return} 1;
00812       \}
00813     \}
00814   \}
00815 
00816   \textcolor{keywordflow}{return} 0;
00817 \}
00818 
00819 
00820 PRIVATE INLINE
00821 \textcolor{keywordtype}{int}
00822 E\_GQuad\_IntLoop(\textcolor{keywordtype}{int}           i,
00823                 \textcolor{keywordtype}{int}           j,
00824                 \textcolor{keywordtype}{int}           type,
00825                 \textcolor{keywordtype}{short}         *S,
00826                 \textcolor{keywordtype}{int}           *ggg,
00827                 \textcolor{keywordtype}{int}           *index,
00828                 \hyperlink{group__energy__parameters_structvrna__param__s}{vrna\_param\_t}  *P)
00829 \{
00830   \textcolor{keywordtype}{int}   energy, ge, \hyperlink{group__model__details_ga72b511ed1201f7e23ec437e468790d74}{dangles}, p, q, l1, minq, maxq, c0;
00831   \textcolor{keywordtype}{short} si, sj;
00832 
00833   dangles = P->\hyperlink{group__energy__parameters_a7b84353eb9075c595bad4ceb871bcae7}{model\_details}.\hyperlink{group__model__details_adcda4ff2ea77748ae0e8700288282efc}{dangles};
00834   si      = S[i + 1];
00835   sj      = S[j - 1];
00836   energy  = 0;
00837 
00838   \textcolor{keywordflow}{if} (dangles == 2)
00839     energy += P->mismatchI[type][si][sj];
00840 
00841   \textcolor{keywordflow}{if} (type > 2)
00842     energy += P->TerminalAU;
00843 
00844   ge = \hyperlink{energy__const_8h_a12c2040f25d8e3a7b9e1c2024c618cb6}{INF};
00845 
00846   p = i + 1;
00847   \textcolor{keywordflow}{if} (S[p] == 3) \{
00848     \textcolor{keywordflow}{if} (p < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE) \{
00849       minq  = j - i + p - MAXLOOP - 2;
00850       c0    = p + VRNA\_GQUAD\_MIN\_BOX\_SIZE - 1;
00851       minq  = \hyperlink{group__utils_ga33297b3679c713b0c4d897cd0fe3b122}{MAX2}(c0, minq);
00852       c0    = j - 3;
00853       maxq  = p + VRNA\_GQUAD\_MAX\_BOX\_SIZE + 1;
00854       maxq  = \hyperlink{group__utils_gae0b9cd0ce090bd69b951aa73e8fa4f7d}{MIN2}(c0, maxq);
00855       \textcolor{keywordflow}{for} (q = minq; q < maxq; q++) \{
00856         \textcolor{keywordflow}{if} (S[q] != 3)
00857           \textcolor{keywordflow}{continue};
00858 
00859         c0  = energy + ggg[index[q] + p] + P->internal\_loop[j - q - 1];
00860         ge  = \hyperlink{group__utils_gae0b9cd0ce090bd69b951aa73e8fa4f7d}{MIN2}(ge, c0);
00861       \}
00862     \}
00863   \}
00864 
00865   \textcolor{keywordflow}{for} (p = i + 2;
00866        p < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE;
00867        p++) \{
00868     l1 = p - i - 1;
00869     \textcolor{keywordflow}{if} (l1 > MAXLOOP)
00870       \textcolor{keywordflow}{break};
00871 
00872     \textcolor{keywordflow}{if} (S[p] != 3)
00873       \textcolor{keywordflow}{continue};
00874 
00875     minq  = j - i + p - MAXLOOP - 2;
00876     c0    = p + VRNA\_GQUAD\_MIN\_BOX\_SIZE - 1;
00877     minq  = \hyperlink{group__utils_ga33297b3679c713b0c4d897cd0fe3b122}{MAX2}(c0, minq);
00878     c0    = j - 1;
00879     maxq  = p + VRNA\_GQUAD\_MAX\_BOX\_SIZE + 1;
00880     maxq  = \hyperlink{group__utils_gae0b9cd0ce090bd69b951aa73e8fa4f7d}{MIN2}(c0, maxq);
00881     \textcolor{keywordflow}{for} (q = minq; q < maxq; q++) \{
00882       \textcolor{keywordflow}{if} (S[q] != 3)
00883         \textcolor{keywordflow}{continue};
00884 
00885       c0  = energy + ggg[index[q] + p] + P->internal\_loop[l1 + j - q - 1];
00886       ge  = \hyperlink{group__utils_gae0b9cd0ce090bd69b951aa73e8fa4f7d}{MIN2}(ge, c0);
00887     \}
00888   \}
00889 
00890   q = j - 1;
00891   \textcolor{keywordflow}{if} (S[q] == 3)
00892     \textcolor{keywordflow}{for} (p = i + 4;
00893          p < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE;
00894          p++) \{
00895       l1 = p - i - 1;
00896       \textcolor{keywordflow}{if} (l1 > MAXLOOP)
00897         \textcolor{keywordflow}{break};
00898 
00899       \textcolor{keywordflow}{if} (S[p] != 3)
00900         \textcolor{keywordflow}{continue};
00901 
00902       c0  = energy + ggg[index[q] + p] + P->internal\_loop[l1];
00903       ge  = \hyperlink{group__utils_gae0b9cd0ce090bd69b951aa73e8fa4f7d}{MIN2}(ge, c0);
00904     \}
00905 
00906 \textcolor{preprocessor}{#if 0}
00907   \textcolor{comment}{/* here comes the additional stuff for the odd dangle models */}
00908   \textcolor{keywordflow}{if} (dangles % 1) \{
00909     en1 = energy + P->dangle5[type][si];
00910     en2 = energy + P->dangle5[type][sj];
00911     en3 = energy + P->mismatchI[type][si][sj];
00912 
00913     \textcolor{comment}{/* first case with 5' dangle (i.e. j-1) onto enclosing pair */}
00914     p = i + 1;
00915     \textcolor{keywordflow}{if} (S[p] == 3) \{
00916       \textcolor{keywordflow}{if} (p < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE) \{
00917         minq  = j - i + p - MAXLOOP - 2;
00918         c0    = p + VRNA\_GQUAD\_MIN\_BOX\_SIZE - 1;
00919         minq  = \hyperlink{group__utils_ga33297b3679c713b0c4d897cd0fe3b122}{MAX2}(c0, minq);
00920         c0    = j - 4;
00921         maxq  = p + VRNA\_GQUAD\_MAX\_BOX\_SIZE + 1;
00922         maxq  = \hyperlink{group__utils_gae0b9cd0ce090bd69b951aa73e8fa4f7d}{MIN2}(c0, maxq);
00923         \textcolor{keywordflow}{for} (q = minq; q < maxq; q++) \{
00924           \textcolor{keywordflow}{if} (S[q] != 3)
00925             \textcolor{keywordflow}{continue};
00926 
00927           c0  = en1 + ggg[index[q] + p] + P->internal\_loop[j - q - 1];
00928           ge  = \hyperlink{group__utils_gae0b9cd0ce090bd69b951aa73e8fa4f7d}{MIN2}(ge, c0);
00929         \}
00930       \}
00931     \}
00932 
00933     \textcolor{keywordflow}{for} (p = i + 2; p < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE; p++) \{
00934       l1 = p - i - 1;
00935       \textcolor{keywordflow}{if} (l1 > MAXLOOP)
00936         \textcolor{keywordflow}{break};
00937 
00938       \textcolor{keywordflow}{if} (S[p] != 3)
00939         \textcolor{keywordflow}{continue};
00940 
00941       minq  = j - i + p - MAXLOOP - 2;
00942       c0    = p + VRNA\_GQUAD\_MIN\_BOX\_SIZE - 1;
00943       minq  = \hyperlink{group__utils_ga33297b3679c713b0c4d897cd0fe3b122}{MAX2}(c0, minq);
00944       c0    = j - 2;
00945       maxq  = p + VRNA\_GQUAD\_MAX\_BOX\_SIZE + 1;
00946       maxq  = \hyperlink{group__utils_gae0b9cd0ce090bd69b951aa73e8fa4f7d}{MIN2}(c0, maxq);
00947       \textcolor{keywordflow}{for} (q = minq; q < maxq; q++) \{
00948         \textcolor{keywordflow}{if} (S[q] != 3)
00949           \textcolor{keywordflow}{continue};
00950 
00951         c0  = en1 + ggg[index[q] + p] + P->internal\_loop[l1 + j - q - 1];
00952         ge  = \hyperlink{group__utils_gae0b9cd0ce090bd69b951aa73e8fa4f7d}{MIN2}(ge, c0);
00953       \}
00954     \}
00955 
00956     q = j - 2;
00957     \textcolor{keywordflow}{if} (S[q] == 3)
00958       \textcolor{keywordflow}{for} (p = i + 4; p < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE; p++) \{
00959         l1 = p - i - 1;
00960         \textcolor{keywordflow}{if} (l1 > MAXLOOP)
00961           \textcolor{keywordflow}{break};
00962 
00963         \textcolor{keywordflow}{if} (S[p] != 3)
00964           \textcolor{keywordflow}{continue};
00965 
00966         c0  = en1 + ggg[index[q] + p] + P->internal\_loop[l1 + 1];
00967         ge  = \hyperlink{group__utils_gae0b9cd0ce090bd69b951aa73e8fa4f7d}{MIN2}(ge, c0);
00968       \}
00969 
00970     \textcolor{comment}{/* second case with 3' dangle (i.e. i+1) onto enclosing pair */}
00971   \}
00972 
00973 \textcolor{preprocessor}{#endif}
00974   \textcolor{keywordflow}{return} ge;
00975 \}
00976 
00977 
00978 PRIVATE INLINE
00979 \textcolor{keywordtype}{int} *
00980 E\_GQuad\_IntLoop\_exhaustive(\textcolor{keywordtype}{int}          i,
00981                            \textcolor{keywordtype}{int}          j,
00982                            \textcolor{keywordtype}{int}          **p\_p,
00983                            \textcolor{keywordtype}{int}          **q\_p,
00984                            \textcolor{keywordtype}{int}          type,
00985                            \textcolor{keywordtype}{short}        *S,
00986                            \textcolor{keywordtype}{int}          *ggg,
00987                            \textcolor{keywordtype}{int}          threshold,
00988                            \textcolor{keywordtype}{int}          *index,
00989                            \hyperlink{group__energy__parameters_structvrna__param__s}{vrna\_param\_t} *P)
00990 \{
00991   \textcolor{keywordtype}{int}   energy, *ge, \hyperlink{group__model__details_ga72b511ed1201f7e23ec437e468790d74}{dangles}, p, q, l1, minq, maxq, c0;
00992   \textcolor{keywordtype}{short} si, sj;
00993   \textcolor{keywordtype}{int}   cnt = 0;
00994 
00995   dangles = P->\hyperlink{group__energy__parameters_a7b84353eb9075c595bad4ceb871bcae7}{model\_details}.\hyperlink{group__model__details_adcda4ff2ea77748ae0e8700288282efc}{dangles};
00996   si      = S[i + 1];
00997   sj      = S[j - 1];
00998   energy  = 0;
00999 
01000   \textcolor{keywordflow}{if} (dangles == 2)
01001     energy += P->mismatchI[type][si][sj];
01002 
01003   \textcolor{keywordflow}{if} (type > 2)
01004     energy += P->TerminalAU;
01005 
01006   \textcolor{comment}{/* guess how many gquads are possible in interval [i+1,j-1] */}
01007   *p\_p  = (\textcolor{keywordtype}{int} *)\hyperlink{group__utils_gaf37a0979367c977edfb9da6614eebe99}{vrna\_alloc}(\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{int}) * 256);
01008   *q\_p  = (\textcolor{keywordtype}{int} *)\hyperlink{group__utils_gaf37a0979367c977edfb9da6614eebe99}{vrna\_alloc}(\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{int}) * 256);
01009   ge    = (\textcolor{keywordtype}{int} *)\hyperlink{group__utils_gaf37a0979367c977edfb9da6614eebe99}{vrna\_alloc}(\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{int}) * 256);
01010 
01011   p = i + 1;
01012   \textcolor{keywordflow}{if} (S[p] == 3) \{
01013     \textcolor{keywordflow}{if} (p < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE) \{
01014       minq  = j - i + p - MAXLOOP - 2;
01015       c0    = p + VRNA\_GQUAD\_MIN\_BOX\_SIZE - 1;
01016       minq  = \hyperlink{group__utils_ga33297b3679c713b0c4d897cd0fe3b122}{MAX2}(c0, minq);
01017       c0    = j - 3;
01018       maxq  = p + VRNA\_GQUAD\_MAX\_BOX\_SIZE + 1;
01019       maxq  = \hyperlink{group__utils_gae0b9cd0ce090bd69b951aa73e8fa4f7d}{MIN2}(c0, maxq);
01020       \textcolor{keywordflow}{for} (q = minq; q < maxq; q++) \{
01021         \textcolor{keywordflow}{if} (S[q] != 3)
01022           \textcolor{keywordflow}{continue};
01023 
01024         c0 = energy + ggg[index[q] + p] + P->internal\_loop[j - q - 1];
01025         \textcolor{keywordflow}{if} (c0 <= threshold) \{
01026           ge[cnt]       = energy + P->internal\_loop[j - q - 1];
01027           (*p\_p)[cnt]   = p;
01028           (*q\_p)[cnt++] = q;
01029         \}
01030       \}
01031     \}
01032   \}
01033 
01034   \textcolor{keywordflow}{for} (p = i + 2;
01035        p < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE;
01036        p++) \{
01037     l1 = p - i - 1;
01038     \textcolor{keywordflow}{if} (l1 > MAXLOOP)
01039       \textcolor{keywordflow}{break};
01040 
01041     \textcolor{keywordflow}{if} (S[p] != 3)
01042       \textcolor{keywordflow}{continue};
01043 
01044     minq  = j - i + p - MAXLOOP - 2;
01045     c0    = p + VRNA\_GQUAD\_MIN\_BOX\_SIZE - 1;
01046     minq  = \hyperlink{group__utils_ga33297b3679c713b0c4d897cd0fe3b122}{MAX2}(c0, minq);
01047     c0    = j - 1;
01048     maxq  = p + VRNA\_GQUAD\_MAX\_BOX\_SIZE + 1;
01049     maxq  = \hyperlink{group__utils_gae0b9cd0ce090bd69b951aa73e8fa4f7d}{MIN2}(c0, maxq);
01050     \textcolor{keywordflow}{for} (q = minq; q < maxq; q++) \{
01051       \textcolor{keywordflow}{if} (S[q] != 3)
01052         \textcolor{keywordflow}{continue};
01053 
01054       c0 = energy + ggg[index[q] + p] + P->internal\_loop[l1 + j - q - 1];
01055       \textcolor{keywordflow}{if} (c0 <= threshold) \{
01056         ge[cnt]       = energy + P->internal\_loop[l1 + j - q - 1];
01057         (*p\_p)[cnt]   = p;
01058         (*q\_p)[cnt++] = q;
01059       \}
01060     \}
01061   \}
01062 
01063   q = j - 1;
01064   \textcolor{keywordflow}{if} (S[q] == 3)
01065     \textcolor{keywordflow}{for} (p = i + 4;
01066          p < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE;
01067          p++) \{
01068       l1 = p - i - 1;
01069       \textcolor{keywordflow}{if} (l1 > MAXLOOP)
01070         \textcolor{keywordflow}{break};
01071 
01072       \textcolor{keywordflow}{if} (S[p] != 3)
01073         \textcolor{keywordflow}{continue};
01074 
01075       c0 = energy + ggg[index[q] + p] + P->internal\_loop[l1];
01076       \textcolor{keywordflow}{if} (c0 <= threshold) \{
01077         ge[cnt]       = energy + P->internal\_loop[l1];
01078         (*p\_p)[cnt]   = p;
01079         (*q\_p)[cnt++] = q;
01080       \}
01081     \}
01082 
01083   (*p\_p)[cnt] = -1;
01084 
01085   \textcolor{keywordflow}{return} ge;
01086 \}
01087 
01088 
01089 PRIVATE INLINE
01090 \textcolor{keywordtype}{int}
01091 E\_GQuad\_IntLoop\_L(\textcolor{keywordtype}{int}           i,
01092                   \textcolor{keywordtype}{int}           j,
01093                   \textcolor{keywordtype}{int}           type,
01094                   \textcolor{keywordtype}{short}         *S,
01095                   \textcolor{keywordtype}{int}           **ggg,
01096                   \textcolor{keywordtype}{int}           maxdist,
01097                   \hyperlink{group__energy__parameters_structvrna__param__s}{vrna\_param\_t}  *P)
01098 \{
01099   \textcolor{keywordtype}{int}   energy, ge, \hyperlink{group__model__details_ga72b511ed1201f7e23ec437e468790d74}{dangles}, p, q, l1, minq, maxq, c0;
01100   \textcolor{keywordtype}{short} si, sj;
01101 
01102   dangles = P->\hyperlink{group__energy__parameters_a7b84353eb9075c595bad4ceb871bcae7}{model\_details}.\hyperlink{group__model__details_adcda4ff2ea77748ae0e8700288282efc}{dangles};
01103   si      = S[i + 1];
01104   sj      = S[j - 1];
01105   energy  = 0;
01106 
01107   \textcolor{keywordflow}{if} (dangles == 2)
01108     energy += P->mismatchI[type][si][sj];
01109 
01110   \textcolor{keywordflow}{if} (type > 2)
01111     energy += P->TerminalAU;
01112 
01113   ge = \hyperlink{energy__const_8h_a12c2040f25d8e3a7b9e1c2024c618cb6}{INF};
01114 
01115   p = i + 1;
01116   \textcolor{keywordflow}{if} (S[p] == 3) \{
01117     \textcolor{keywordflow}{if} (p < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE) \{
01118       minq  = j - i + p - MAXLOOP - 2;
01119       c0    = p + VRNA\_GQUAD\_MIN\_BOX\_SIZE - 1;
01120       minq  = \hyperlink{group__utils_ga33297b3679c713b0c4d897cd0fe3b122}{MAX2}(c0, minq);
01121       c0    = j - 3;
01122       maxq  = p + VRNA\_GQUAD\_MAX\_BOX\_SIZE + 1;
01123       maxq  = \hyperlink{group__utils_gae0b9cd0ce090bd69b951aa73e8fa4f7d}{MIN2}(c0, maxq);
01124       \textcolor{keywordflow}{for} (q = minq; q < maxq; q++) \{
01125         \textcolor{keywordflow}{if} (S[q] != 3)
01126           \textcolor{keywordflow}{continue};
01127 
01128         c0  = energy + ggg[p][q - p] + P->internal\_loop[j - q - 1];
01129         ge  = \hyperlink{group__utils_gae0b9cd0ce090bd69b951aa73e8fa4f7d}{MIN2}(ge, c0);
01130       \}
01131     \}
01132   \}
01133 
01134   \textcolor{keywordflow}{for} (p = i + 2;
01135        p < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE;
01136        p++) \{
01137     l1 = p - i - 1;
01138     \textcolor{keywordflow}{if} (l1 > MAXLOOP)
01139       \textcolor{keywordflow}{break};
01140 
01141     \textcolor{keywordflow}{if} (S[p] != 3)
01142       \textcolor{keywordflow}{continue};
01143 
01144     minq  = j - i + p - MAXLOOP - 2;
01145     c0    = p + VRNA\_GQUAD\_MIN\_BOX\_SIZE - 1;
01146     minq  = \hyperlink{group__utils_ga33297b3679c713b0c4d897cd0fe3b122}{MAX2}(c0, minq);
01147     c0    = j - 1;
01148     maxq  = p + VRNA\_GQUAD\_MAX\_BOX\_SIZE + 1;
01149     maxq  = \hyperlink{group__utils_gae0b9cd0ce090bd69b951aa73e8fa4f7d}{MIN2}(c0, maxq);
01150     \textcolor{keywordflow}{for} (q = minq; q < maxq; q++) \{
01151       \textcolor{keywordflow}{if} (S[q] != 3)
01152         \textcolor{keywordflow}{continue};
01153 
01154       c0  = energy + ggg[p][q - p] + P->internal\_loop[l1 + j - q - 1];
01155       ge  = \hyperlink{group__utils_gae0b9cd0ce090bd69b951aa73e8fa4f7d}{MIN2}(ge, c0);
01156     \}
01157   \}
01158 
01159   q = j - 1;
01160   \textcolor{keywordflow}{if} (S[q] == 3)
01161     \textcolor{keywordflow}{for} (p = i + 4;
01162          p < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE;
01163          p++) \{
01164       l1 = p - i - 1;
01165       \textcolor{keywordflow}{if} (l1 > MAXLOOP)
01166         \textcolor{keywordflow}{break};
01167 
01168       \textcolor{keywordflow}{if} (S[p] != 3)
01169         \textcolor{keywordflow}{continue};
01170 
01171       c0  = energy + ggg[p][q - p] + P->internal\_loop[l1];
01172       ge  = \hyperlink{group__utils_gae0b9cd0ce090bd69b951aa73e8fa4f7d}{MIN2}(ge, c0);
01173     \}
01174 
01175   \textcolor{keywordflow}{return} ge;
01176 \}
01177 
01178 
01179 PRIVATE INLINE
01180 \hyperlink{group__data__structures_ga31125aeace516926bf7f251f759b6126}{FLT\_OR\_DBL}
01181 exp\_E\_GQuad\_IntLoop(\textcolor{keywordtype}{int}               i,
01182                     \textcolor{keywordtype}{int}               j,
01183                     \textcolor{keywordtype}{int}               type,
01184                     \textcolor{keywordtype}{short}             *S,
01185                     \hyperlink{group__data__structures_ga31125aeace516926bf7f251f759b6126}{FLT\_OR\_DBL}        *G,
01186                     \hyperlink{group__data__structures_ga31125aeace516926bf7f251f759b6126}{FLT\_OR\_DBL}        *scale,
01187                     \textcolor{keywordtype}{int}               *index,
01188                     \hyperlink{group__energy__parameters_structvrna__exp__param__s}{vrna\_exp\_param\_t}  *pf)
01189 \{
01190   \textcolor{keywordtype}{int}         k, l, minl, maxl, u, r;
01191   \hyperlink{group__data__structures_ga31125aeace516926bf7f251f759b6126}{FLT\_OR\_DBL}  q, qe;
01192   \textcolor{keywordtype}{double}      *expintern;
01193   \textcolor{keywordtype}{short}       si, sj;
01194 
01195   q         = 0;
01196   si        = S[i + 1];
01197   sj        = S[j - 1];
01198   qe        = (\hyperlink{group__data__structures_ga31125aeace516926bf7f251f759b6126}{FLT\_OR\_DBL})pf->expmismatchI[type][si][sj];
01199   expintern = &(pf->expinternal[0]);
01200 
01201   \textcolor{keywordflow}{if} (type > 2)
01202     qe *= (\hyperlink{group__data__structures_ga31125aeace516926bf7f251f759b6126}{FLT\_OR\_DBL})pf->expTermAU;
01203 
01204   k = i + 1;
01205   if (S[k] == 3) \{
01206     \textcolor{keywordflow}{if} (k < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE) \{
01207       minl  = j - MAXLOOP - 1;
01208       u     = k + VRNA\_GQUAD\_MIN\_BOX\_SIZE - 1;
01209       minl  = \hyperlink{group__utils_ga33297b3679c713b0c4d897cd0fe3b122}{MAX2}(u, minl);
01210       u     = j - 3;
01211       maxl  = k + VRNA\_GQUAD\_MAX\_BOX\_SIZE + 1;
01212       maxl  = \hyperlink{group__utils_gae0b9cd0ce090bd69b951aa73e8fa4f7d}{MIN2}(u, maxl);
01213       \textcolor{keywordflow}{for} (l = minl; l < maxl; l++) \{
01214         \textcolor{keywordflow}{if} (S[l] != 3)
01215           \textcolor{keywordflow}{continue};
01216 
01217         \textcolor{keywordflow}{if} (G[index[k] - l] == 0.)
01218           \textcolor{keywordflow}{continue};
01219 
01220         q += qe
01221              * G[index[k] - l]
01222              * (\hyperlink{group__data__structures_ga31125aeace516926bf7f251f759b6126}{FLT\_OR\_DBL})expintern[j - l - 1]
01223              * scale[j - l + 1];
01224       \}
01225     \}
01226   \}
01227 
01228   \textcolor{keywordflow}{for} (k = i + 2;
01229        k <= j - VRNA\_GQUAD\_MIN\_BOX\_SIZE;
01230        k++) \{
01231     u = k - i - 1;
01232     \textcolor{keywordflow}{if} (u > MAXLOOP)
01233       \textcolor{keywordflow}{break};
01234 
01235     \textcolor{keywordflow}{if} (S[k] != 3)
01236       \textcolor{keywordflow}{continue};
01237 
01238     minl  = j - i + k - MAXLOOP - 2;
01239     r     = k + VRNA\_GQUAD\_MIN\_BOX\_SIZE - 1;
01240     minl  = \hyperlink{group__utils_ga33297b3679c713b0c4d897cd0fe3b122}{MAX2}(r, minl);
01241     maxl  = k + VRNA\_GQUAD\_MAX\_BOX\_SIZE + 1;
01242     r     = j - 1;
01243     maxl  = \hyperlink{group__utils_gae0b9cd0ce090bd69b951aa73e8fa4f7d}{MIN2}(r, maxl);
01244     \textcolor{keywordflow}{for} (l = minl; l < maxl; l++) \{
01245       \textcolor{keywordflow}{if} (S[l] != 3)
01246         \textcolor{keywordflow}{continue};
01247 
01248       \textcolor{keywordflow}{if} (G[index[k] - l] == 0.)
01249         \textcolor{keywordflow}{continue};
01250 
01251       q += qe
01252            * G[index[k] - l]
01253            * (\hyperlink{group__data__structures_ga31125aeace516926bf7f251f759b6126}{FLT\_OR\_DBL})expintern[u + j - l - 1]
01254            * scale[u + j - l + 1];
01255     \}
01256   \}
01257 
01258   l = j - 1;
01259   \textcolor{keywordflow}{if} (S[l] == 3)
01260     \textcolor{keywordflow}{for} (k = i + 4; k <= j - VRNA\_GQUAD\_MIN\_BOX\_SIZE; k++) \{
01261       u = k - i - 1;
01262       \textcolor{keywordflow}{if} (u > MAXLOOP)
01263         \textcolor{keywordflow}{break};
01264 
01265       \textcolor{keywordflow}{if} (S[k] != 3)
01266         \textcolor{keywordflow}{continue};
01267 
01268       \textcolor{keywordflow}{if} (G[index[k] - l] == 0.)
01269         \textcolor{keywordflow}{continue};
01270 
01271       q += qe
01272            * G[index[k] - l]
01273            * (\hyperlink{group__data__structures_ga31125aeace516926bf7f251f759b6126}{FLT\_OR\_DBL})expintern[u]
01274            * scale[u + 2];
01275     \}
01276 
01277   \textcolor{keywordflow}{return} q;
01278 \}
01279 
01280 
01286 \textcolor{preprocessor}{#endif}
\end{DoxyCode}
